<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>STATS5099 Data Mining and Machine Learning</title>
  <meta name="description" content="STATS5099 Data Mining and Machine Learning" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="STATS5099 Data Mining and Machine Learning" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="STATS5099 Data Mining and Machine Learning" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  

<link rel="next" href="exercise-1-task-2-in-lecture-notes.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="include/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome to DMML Lab 8</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#implementing-neural-networks-in-r"><i class="fa fa-check"></i><b>1.1</b> Implementing neural networks in <code>R</code></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exercise-1-task-2-in-lecture-notes.html"><a href="exercise-1-task-2-in-lecture-notes.html"><i class="fa fa-check"></i><b>2</b> Exercise 1: Task 2 in lecture notes</a></li>
<li class="chapter" data-level="3" data-path="exercise-2-german-data.html"><a href="exercise-2-german-data.html"><i class="fa fa-check"></i><b>3</b> Exercise 2: German data</a></li>
<li class="chapter" data-level="4" data-path="exercise-3-dividend-data.html"><a href="exercise-3-dividend-data.html"><i class="fa fa-check"></i><b>4</b> Exercise 3: Dividend data</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STATS5099 Data Mining and Machine Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">STATS5099 Data Mining and Machine Learning</h1>
</div>
<div id="welcome-to-dmml-lab-8" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">1</span> Welcome to DMML Lab 8<a href="index.html#welcome-to-dmml-lab-8" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In week 8, we have studied neural networks, which consists an input layer, an output layer and any number of hidden layers specified by the user. In this lab, we will see how to fit neural networks in <code>R</code> and <code>Python</code>.</p>
<div id="implementing-neural-networks-in-r" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Implementing neural networks in <code>R</code><a href="index.html#implementing-neural-networks-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To fit a relatively simple neural network (by simple, it means the network does not contain too many hidden layers, is not optimised using too advanced algorithms, and/or does not include regularisation techniques such as dropout), we use the <code>neuralnet</code> function from the <code>neuralnet</code> package. In particular, we need to specify the number of hidden layers and hidden nodes using the argument <code>hidden</code>, the loss function using <code>err.fct</code>, the activation function using <code>act.fct</code>, the activation function for the output layer using <code>linear.output</code> (set to <code>TRUE</code> for a linear activation function and <code>FALSE</code> to be the same as the activation function specified in <code>act.fct</code>). There are many other arguments could be manually set, such as the optimisation algorithm and learning rate; see help page of <code>neuralnet</code> for more details.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="index.html#cb1-1" tabindex="-1"></a><span class="fu">library</span>(neuralnet)</span>
<span id="cb1-2"><a href="index.html#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="index.html#cb1-3" tabindex="-1"></a><span class="co"># an example neural network for regression tasks</span></span>
<span id="cb1-4"><a href="index.html#cb1-4" tabindex="-1"></a>Model <span class="ot">&lt;-</span> <span class="fu">neuralnet</span>(Y<span class="sc">~</span>X1<span class="sc">+</span>X2<span class="sc">+</span>..., data, <span class="at">hidden=</span><span class="fu">c</span>(<span class="dv">5</span>), <span class="at">err.fct=</span><span class="st">&quot;sse&quot;</span>, <span class="at">act.fct=</span><span class="st">&quot;logistic&quot;</span>, <span class="at">linear.output=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-5"><a href="index.html#cb1-5" tabindex="-1"></a><span class="co"># The network contains a single hidden layers with 5 hidden nodes.</span></span>
<span id="cb1-6"><a href="index.html#cb1-6" tabindex="-1"></a><span class="co"># The network uses sum of squared errors as the loss function.</span></span>
<span id="cb1-7"><a href="index.html#cb1-7" tabindex="-1"></a><span class="co"># The network uses logistic function as the activation function for hidden nodes </span></span>
<span id="cb1-8"><a href="index.html#cb1-8" tabindex="-1"></a><span class="co"># and linear function as the activation function for output nodes. </span></span>
<span id="cb1-9"><a href="index.html#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="index.html#cb1-10" tabindex="-1"></a><span class="co"># an example neural network for classification tasks</span></span>
<span id="cb1-11"><a href="index.html#cb1-11" tabindex="-1"></a>softplus <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">log</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(x))</span>
<span id="cb1-12"><a href="index.html#cb1-12" tabindex="-1"></a>Model <span class="ot">&lt;-</span> <span class="fu">neuralnet</span>(Y<span class="sc">~</span>X1<span class="sc">+</span>X2<span class="sc">+</span>..., data, <span class="at">hidden=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">3</span>), <span class="at">err.fct=</span><span class="st">&quot;ce&quot;</span>, <span class="at">act.fct=</span>softplus, <span class="at">linear.output=</span><span class="cn">FALSE</span>)</span>
<span id="cb1-13"><a href="index.html#cb1-13" tabindex="-1"></a><span class="co"># The network contains two hidden layers with 5 and 3 hidden nodes in each layer.</span></span>
<span id="cb1-14"><a href="index.html#cb1-14" tabindex="-1"></a><span class="co"># The network uses cross entropy as the loss function.</span></span>
<span id="cb1-15"><a href="index.html#cb1-15" tabindex="-1"></a><span class="co"># The network uses a user-defined softplus function as the activation function for hidden nodes and output nodes.</span></span>
<span id="cb1-16"><a href="index.html#cb1-16" tabindex="-1"></a><span class="co"># The softplus function is a smooth approximation to rectified linear unit (ReLU) function. </span></span></code></pre></div>
<p>To visualise the neural network, we could use the default <code>plot</code> function or <code>plotnet</code> function from the <code>NeuralNetTools</code> package.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="index.html#cb2-1" tabindex="-1"></a><span class="co"># option 1</span></span>
<span id="cb2-2"><a href="index.html#cb2-2" tabindex="-1"></a><span class="fu">plot</span>(Model)</span>
<span id="cb2-3"><a href="index.html#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="index.html#cb2-4" tabindex="-1"></a><span class="co"># option 2</span></span>
<span id="cb2-5"><a href="index.html#cb2-5" tabindex="-1"></a><span class="co"># library(devtools); install_github(&#39;fawda123/NeuralNetTools&#39;)</span></span>
<span id="cb2-6"><a href="index.html#cb2-6" tabindex="-1"></a><span class="fu">library</span>(NeuralNetTools)</span>
<span id="cb2-7"><a href="index.html#cb2-7" tabindex="-1"></a><span class="fu">plotnet</span>(Model)</span></code></pre></div>
<p>To use the model for predicting new observations, we could use the default <code>predict</code> function or the <code>compute</code> function. This returns the probability of the observation in each class and hence requires further conversion to evaluate the classification performance.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="index.html#cb3-1" tabindex="-1"></a><span class="co"># option 1</span></span>
<span id="cb3-2"><a href="index.html#cb3-2" tabindex="-1"></a>test_predict_prob<span class="ot">&lt;-</span> <span class="fu">predict</span>(model, test_data)</span>
<span id="cb3-3"><a href="index.html#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="index.html#cb3-4" tabindex="-1"></a><span class="co"># option 2</span></span>
<span id="cb3-5"><a href="index.html#cb3-5" tabindex="-1"></a>test_predict_prob<span class="ot">&lt;-</span> neuralnet<span class="sc">::</span><span class="fu">compute</span>(model, test_data)<span class="sc">$</span>net.result</span>
<span id="cb3-6"><a href="index.html#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="index.html#cb3-7" tabindex="-1"></a><span class="co"># convert to class label for binary classification</span></span>
<span id="cb3-8"><a href="index.html#cb3-8" tabindex="-1"></a>test_predict_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test_predict_prob<span class="sc">&gt;</span><span class="fl">0.5</span>, class1, class2) <span class="co">#class 1 and class 2 are the class names</span></span>
<span id="cb3-9"><a href="index.html#cb3-9" tabindex="-1"></a></span>
<span id="cb3-10"><a href="index.html#cb3-10" tabindex="-1"></a><span class="co"># convert to class label for multi-class classification</span></span>
<span id="cb3-11"><a href="index.html#cb3-11" tabindex="-1"></a>test_predict_class <span class="ot">&lt;-</span> <span class="fu">apply</span>(test_predict_prob, <span class="dv">1</span>, which.max)</span></code></pre></div>

</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script>
            </section>

          </div>
        </div>
      </div>

<a href="exercise-1-task-2-in-lecture-notes.html" class="navigation navigation-next navigation-unique" aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["main.pdf", "main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
