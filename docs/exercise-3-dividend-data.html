<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Exercise 3: Dividend data | STATS5099 Data Mining and Machine Learning</title>
  <meta name="description" content="5 Exercise 3: Dividend data | STATS5099 Data Mining and Machine Learning" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Exercise 3: Dividend data | STATS5099 Data Mining and Machine Learning" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Exercise 3: Dividend data | STATS5099 Data Mining and Machine Learning" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction-to-pytorch.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="include/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome to DMML Lab 8</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#implementing-neural-networks-in-r"><i class="fa fa-check"></i><b>1.1</b> Implementing neural networks in <code>R</code></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exercise-1-task-2-in-lecture-notes.html"><a href="exercise-1-task-2-in-lecture-notes.html"><i class="fa fa-check"></i><b>2</b> Exercise 1: Task 2 in lecture notes</a></li>
<li class="chapter" data-level="3" data-path="exercise-2-german-data.html"><a href="exercise-2-german-data.html"><i class="fa fa-check"></i><b>3</b> Exercise 2: German data</a></li>
<li class="chapter" data-level="4" data-path="introduction-to-pytorch.html"><a href="introduction-to-pytorch.html"><i class="fa fa-check"></i><b>4</b> Introduction to PyTorch</a>
<ul>
<li class="chapter" data-level="4.1" data-path="introduction-to-pytorch.html"><a href="introduction-to-pytorch.html#install-pytorch"><i class="fa fa-check"></i><b>4.1</b> Install PyTorch</a></li>
<li class="chapter" data-level="4.2" data-path="introduction-to-pytorch.html"><a href="introduction-to-pytorch.html#what-is-pytorch"><i class="fa fa-check"></i><b>4.2</b> What is PyTorch?</a></li>
<li class="chapter" data-level="4.3" data-path="introduction-to-pytorch.html"><a href="introduction-to-pytorch.html#basic-computations-on-tensors"><i class="fa fa-check"></i><b>4.3</b> Basic computations on Tensors</a></li>
<li class="chapter" data-level="4.4" data-path="introduction-to-pytorch.html"><a href="introduction-to-pytorch.html#neural-networks-in-pytorch"><i class="fa fa-check"></i><b>4.4</b> Neural networks in PyTorch</a></li>
<li class="chapter" data-level="4.5" data-path="introduction-to-pytorch.html"><a href="introduction-to-pytorch.html#automatic-differentiation-in-pytorch"><i class="fa fa-check"></i><b>4.5</b> Automatic Differentiation in PyTorch</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exercise-3-dividend-data.html"><a href="exercise-3-dividend-data.html"><i class="fa fa-check"></i><b>5</b> Exercise 3: Dividend data</a>
<ul>
<li class="chapter" data-level="" data-path="exercise-3-dividend-data.html"><a href="exercise-3-dividend-data.html#neural-networks-in-r"><i class="fa fa-check"></i>Neural Networks in R</a></li>
<li class="chapter" data-level="" data-path="exercise-3-dividend-data.html"><a href="exercise-3-dividend-data.html#neural-networks-in-pytorch-1"><i class="fa fa-check"></i>Neural Networks in PyTorch</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STATS5099 Data Mining and Machine Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exercise-3-dividend-data" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Exercise 3: Dividend data<a href="exercise-3-dividend-data.html#exercise-3-dividend-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this example, our goal is to develop a neural network to determine if a stock pays a dividend or not. The dataset is stored under <code>dividendinfo.csv</code>, which includes one response variable and five predictor variables.</p>
<ul>
<li><code>dividend</code> (class): A value of 1 indicates that the stock pays a dividend; 0 indicates that the stock that does not pay a dividend.</li>
<li><code>fcfps</code>: Free cash flow per share (in $)</li>
<li><code>earnings_growth</code>: Earnings growth in the past year (in %)</li>
<li><code>de</code>: Debt to Equity ratio</li>
<li><code>mcap</code>: Market Capitalization of the stock</li>
<li><code>current_ratio</code>: Current Ratio (or Current Assets/Current Liabilities)</li>
</ul>
<div id="neural-networks-in-r" class="section level2 unnumbered hasAnchor">
<h2>Neural Networks in R<a href="exercise-3-dividend-data.html#neural-networks-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Task</strong></p>
<ol style="list-style-type: decimal">
<li>Read in the data and perform exploratory analysis. What have you observed?</li>
</ol>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="exercise-3-dividend-data.html#cb82-1" tabindex="-1"></a>dividend <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;dividendinfo.csv&quot;</span>)</span>
<span id="cb82-2"><a href="exercise-3-dividend-data.html#cb82-2" tabindex="-1"></a></span>
<span id="cb82-3"><a href="exercise-3-dividend-data.html#cb82-3" tabindex="-1"></a><span class="co"># some example codes for numerical summaries</span></span>
<span id="cb82-4"><a href="exercise-3-dividend-data.html#cb82-4" tabindex="-1"></a><span class="fu">summary</span>(dividend)</span>
<span id="cb82-5"><a href="exercise-3-dividend-data.html#cb82-5" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb82-6"><a href="exercise-3-dividend-data.html#cb82-6" tabindex="-1"></a><span class="fu">skim</span>(dividend)</span>
<span id="cb82-7"><a href="exercise-3-dividend-data.html#cb82-7" tabindex="-1"></a></span>
<span id="cb82-8"><a href="exercise-3-dividend-data.html#cb82-8" tabindex="-1"></a><span class="co"># some example codes for graphical summaries</span></span>
<span id="cb82-9"><a href="exercise-3-dividend-data.html#cb82-9" tabindex="-1"></a><span class="fu">pairs</span>(dividend)</span>
<span id="cb82-10"><a href="exercise-3-dividend-data.html#cb82-10" tabindex="-1"></a><span class="fu">libray</span>(GGally)</span>
<span id="cb82-11"><a href="exercise-3-dividend-data.html#cb82-11" tabindex="-1"></a><span class="fu">ggpairs</span>(dividend)</span>
<span id="cb82-12"><a href="exercise-3-dividend-data.html#cb82-12" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>));</span>
<span id="cb82-13"><a href="exercise-3-dividend-data.html#cb82-13" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(dividend),<span class="cf">function</span>(i) <span class="fu">boxplot</span>(dividend[,i]<span class="sc">~</span>dividend<span class="sc">$</span>dividend)))</span></code></pre></div>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Pre-process and split the data to prepare for training and evaluating a neural network.</li>
</ol>
<div class="webex-solution">
<button>
Hint
</button>
<p>As all variables are continuous and they have quite different ranges, scale them either using standardisation or min-max normalisation.</p>
</div>
<div class="webex-solution">
<button>
Solution
</button>
<p>While there are built-in functions such as <code>scale</code> to standardise the entire data, the best practice is to split the data into training and test first and then apply standardisation/normalisation. This could avoid information leakage from training to test data.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="exercise-3-dividend-data.html#cb83-1" tabindex="-1"></a><span class="co"># Data split</span></span>
<span id="cb83-2"><a href="exercise-3-dividend-data.html#cb83-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb83-3"><a href="exercise-3-dividend-data.html#cb83-3" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(dividend),<span class="fl">0.8</span><span class="sc">*</span><span class="fu">nrow</span>(dividend))</span>
<span id="cb83-4"><a href="exercise-3-dividend-data.html#cb83-4" tabindex="-1"></a>train <span class="ot">&lt;-</span> dividend[idx,]</span>
<span id="cb83-5"><a href="exercise-3-dividend-data.html#cb83-5" tabindex="-1"></a>test <span class="ot">&lt;-</span> dividend[<span class="sc">-</span>idx,]</span>
<span id="cb83-6"><a href="exercise-3-dividend-data.html#cb83-6" tabindex="-1"></a></span>
<span id="cb83-7"><a href="exercise-3-dividend-data.html#cb83-7" tabindex="-1"></a><span class="co"># option 1: Standardise the data</span></span>
<span id="cb83-8"><a href="exercise-3-dividend-data.html#cb83-8" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">apply</span>(train[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>], <span class="dv">2</span>, mean)</span>
<span id="cb83-9"><a href="exercise-3-dividend-data.html#cb83-9" tabindex="-1"></a>sds <span class="ot">&lt;-</span> <span class="fu">apply</span>(train[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>], <span class="dv">2</span>, sd)</span>
<span id="cb83-10"><a href="exercise-3-dividend-data.html#cb83-10" tabindex="-1"></a>train.std <span class="ot">&lt;-</span> <span class="fu">scale</span>(train[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb83-11"><a href="exercise-3-dividend-data.html#cb83-11" tabindex="-1"></a>train.std <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(train[,<span class="dv">1</span>],train.std))</span>
<span id="cb83-12"><a href="exercise-3-dividend-data.html#cb83-12" tabindex="-1"></a>test.std  <span class="ot">&lt;-</span> <span class="fu">scale</span>(test[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>], means, sds)</span>
<span id="cb83-13"><a href="exercise-3-dividend-data.html#cb83-13" tabindex="-1"></a>test.std  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(test[,<span class="dv">1</span>],test.std))</span>
<span id="cb83-14"><a href="exercise-3-dividend-data.html#cb83-14" tabindex="-1"></a><span class="fu">colnames</span>(train.std) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(train)</span>
<span id="cb83-15"><a href="exercise-3-dividend-data.html#cb83-15" tabindex="-1"></a><span class="fu">colnames</span>(test.std)  <span class="ot">&lt;-</span> <span class="fu">colnames</span>(test)</span>
<span id="cb83-16"><a href="exercise-3-dividend-data.html#cb83-16" tabindex="-1"></a></span>
<span id="cb83-17"><a href="exercise-3-dividend-data.html#cb83-17" tabindex="-1"></a><span class="co"># option 2: Normalise the data</span></span>
<span id="cb83-18"><a href="exercise-3-dividend-data.html#cb83-18" tabindex="-1"></a>min_max_scale_test <span class="ot">&lt;-</span> <span class="cf">function</span>(x_tr, x_te){</span>
<span id="cb83-19"><a href="exercise-3-dividend-data.html#cb83-19" tabindex="-1"></a>  mins <span class="ot">&lt;-</span> <span class="fu">apply</span>(x_tr, <span class="dv">2</span>, min)</span>
<span id="cb83-20"><a href="exercise-3-dividend-data.html#cb83-20" tabindex="-1"></a>  maxs <span class="ot">&lt;-</span> <span class="fu">apply</span>(x_tr, <span class="dv">2</span>, max)</span>
<span id="cb83-21"><a href="exercise-3-dividend-data.html#cb83-21" tabindex="-1"></a>  x_te <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mins,maxs, x_te)</span>
<span id="cb83-22"><a href="exercise-3-dividend-data.html#cb83-22" tabindex="-1"></a>  x_te <span class="ot">&lt;-</span> <span class="fu">apply</span>(x_te, <span class="dv">2</span>, <span class="cf">function</span>(x) (x<span class="sc">-</span>x[<span class="dv">1</span>])<span class="sc">/</span>(x[<span class="dv">2</span>]<span class="sc">-</span>x[<span class="dv">1</span>]))</span>
<span id="cb83-23"><a href="exercise-3-dividend-data.html#cb83-23" tabindex="-1"></a>  x_te <span class="ot">&lt;-</span> x_te[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),]</span>
<span id="cb83-24"><a href="exercise-3-dividend-data.html#cb83-24" tabindex="-1"></a>}</span>
<span id="cb83-25"><a href="exercise-3-dividend-data.html#cb83-25" tabindex="-1"></a></span>
<span id="cb83-26"><a href="exercise-3-dividend-data.html#cb83-26" tabindex="-1"></a>train.norm <span class="ot">&lt;-</span><span class="fu">apply</span>(train[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>], <span class="dv">2</span>, <span class="cf">function</span>(x) (x<span class="sc">-</span><span class="fu">min</span>(x))<span class="sc">/</span>(<span class="fu">max</span>(x)<span class="sc">-</span><span class="fu">min</span>(x)) )</span>
<span id="cb83-27"><a href="exercise-3-dividend-data.html#cb83-27" tabindex="-1"></a>train.norm <span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(train[,<span class="dv">1</span>],train.norm))</span>
<span id="cb83-28"><a href="exercise-3-dividend-data.html#cb83-28" tabindex="-1"></a>test.norm  <span class="ot">&lt;-</span><span class="fu">min_max_scale_test</span>(train[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>], test[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb83-29"><a href="exercise-3-dividend-data.html#cb83-29" tabindex="-1"></a>test.norm  <span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(test[,<span class="dv">1</span>], test.norm))</span>
<span id="cb83-30"><a href="exercise-3-dividend-data.html#cb83-30" tabindex="-1"></a><span class="fu">colnames</span>(train.norm) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(train)</span>
<span id="cb83-31"><a href="exercise-3-dividend-data.html#cb83-31" tabindex="-1"></a><span class="fu">colnames</span>(test.norm)  <span class="ot">&lt;-</span> <span class="fu">colnames</span>(test)</span></code></pre></div>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Build a neural network with a single hidden layer, any number of hidden nodes, and the logistic function as the activation function. Interpret the relative importance of variables using the <code>garson</code> function.</li>
</ol>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="exercise-3-dividend-data.html#cb84-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb84-2"><a href="exercise-3-dividend-data.html#cb84-2" tabindex="-1"></a>nn_di <span class="ot">&lt;-</span> <span class="fu">neuralnet</span>(dividend<span class="sc">~</span>., <span class="at">data=</span>train.std, <span class="at">hidden=</span><span class="fu">c</span>(<span class="dv">5</span>), <span class="at">err.fct=</span><span class="st">&quot;ce&quot;</span>, <span class="at">act.fct=</span><span class="st">&quot;logistic&quot;</span>, <span class="at">linear.output=</span><span class="cn">FALSE</span>, <span class="at">likelihood=</span><span class="cn">TRUE</span>)</span>
<span id="cb84-3"><a href="exercise-3-dividend-data.html#cb84-3" tabindex="-1"></a></span>
<span id="cb84-4"><a href="exercise-3-dividend-data.html#cb84-4" tabindex="-1"></a><span class="fu">garson</span>(nn_di)</span></code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>We can see that the variable <code>current_ratio</code> is the one with the strongest relationship with the response variable <code>dividend</code>, followed by <code>de</code>, <code>fcfps</code> and <code>mcap</code>. The variable <code>earnings_growth</code> has the least relationship with <code>dividend</code>.</p>
</div>
<ol start="4" style="list-style-type: decimal">
<li>Fit the above model multiple times using the argument <code>rep</code> and select the optimal model.</li>
</ol>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="exercise-3-dividend-data.html#cb85-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb85-2"><a href="exercise-3-dividend-data.html#cb85-2" tabindex="-1"></a>nn_di <span class="ot">&lt;-</span> <span class="fu">neuralnet</span>(dividend<span class="sc">~</span>., <span class="at">data=</span>train.std, <span class="at">hidden=</span><span class="fu">c</span>(<span class="dv">5</span>), <span class="at">err.fct=</span><span class="st">&quot;ce&quot;</span>, <span class="at">act.fct=</span><span class="st">&quot;logistic&quot;</span>, <span class="at">linear.output=</span><span class="cn">FALSE</span>, <span class="at">likelihood=</span><span class="cn">TRUE</span>, <span class="at">rep=</span><span class="dv">5</span>)</span>
<span id="cb85-3"><a href="exercise-3-dividend-data.html#cb85-3" tabindex="-1"></a></span>
<span id="cb85-4"><a href="exercise-3-dividend-data.html#cb85-4" tabindex="-1"></a><span class="co"># plot(nn_di)</span></span>
<span id="cb85-5"><a href="exercise-3-dividend-data.html#cb85-5" tabindex="-1"></a><span class="fu">plot</span>(nn_di, <span class="at">rep=</span><span class="st">&quot;best&quot;</span>)</span></code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<p>From the plots (<code>plot(nn_di)</code>), we can see that the optimisation algorithm stops at different iterations (from <code>Steps</code>) and lead to differnt cross-entropy loss (from <code>Error</code>). In general, training the network longer decreases the cross-entropy loss. However, this decrease takes place on the training data set and may not generalise to the test. In other words, training the model longer may increase the risk of overfitting.</p>
<p>To select the optimal model, we could look at the AIC and BIC values.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="exercise-3-dividend-data.html#cb86-1" tabindex="-1"></a><span class="fu">which.min</span>(nn_di<span class="sc">$</span>result.matrix[<span class="dv">4</span>,]) <span class="co">#AIC</span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="exercise-3-dividend-data.html#cb88-1" tabindex="-1"></a><span class="fu">which.min</span>(nn_di<span class="sc">$</span>result.matrix[<span class="dv">5</span>,]) <span class="co">#AIC</span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>AIC and BIC agree in this case and they both choose the third repetition.</p>
</div>
<ol start="5" style="list-style-type: decimal">
<li>Evaluate the classification performance.</li>
</ol>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="exercise-3-dividend-data.html#cb90-1" tabindex="-1"></a><span class="co"># Prediction</span></span>
<span id="cb90-2"><a href="exercise-3-dividend-data.html#cb90-2" tabindex="-1"></a>train_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(nn_di, train.std)</span>
<span id="cb90-3"><a href="exercise-3-dividend-data.html#cb90-3" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(train.std<span class="sc">$</span>dividend, train_pred<span class="sc">&gt;</span><span class="fl">0.5</span>))</span></code></pre></div>
<pre><code>##    
##     FALSE TRUE
##   0    77    0
##   1     0   83</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="exercise-3-dividend-data.html#cb92-1" tabindex="-1"></a>test_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(nn_di, test.std)</span>
<span id="cb92-2"><a href="exercise-3-dividend-data.html#cb92-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(test.std<span class="sc">$</span>dividend, test_pred<span class="sc">&gt;</span><span class="fl">0.5</span>))</span></code></pre></div>
<pre><code>##    
##     FALSE TRUE
##   0    18    3
##   1     1   18</code></pre>
</div>
</div>
<div id="neural-networks-in-pytorch-1" class="section level2 unnumbered hasAnchor">
<h2>Neural Networks in PyTorch<a href="exercise-3-dividend-data.html#neural-networks-in-pytorch-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let's try to complete the previous tasks in Python and PyTorch.</p>
<ol start="6" style="list-style-type: decimal">
<li>Load the data, pre-process it and split the data into training and test sets.</li>
</ol>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb94"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="exercise-3-dividend-data.html#cb94-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb94-2"><a href="exercise-3-dividend-data.html#cb94-2" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, MinMaxScaler</span>
<span id="cb94-3"><a href="exercise-3-dividend-data.html#cb94-3" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb94-4"><a href="exercise-3-dividend-data.html#cb94-4" tabindex="-1"></a></span>
<span id="cb94-5"><a href="exercise-3-dividend-data.html#cb94-5" tabindex="-1"></a>dividend <span class="op">=</span> pd.read_csv(<span class="st">&quot;dividendinfo.csv&quot;</span>)</span>
<span id="cb94-6"><a href="exercise-3-dividend-data.html#cb94-6" tabindex="-1"></a>dividend.iloc[:,<span class="dv">1</span>:<span class="dv">6</span>] <span class="op">=</span> dividend.iloc[:,<span class="dv">1</span>:<span class="dv">6</span>].astype(np.float64)</span>
<span id="cb94-7"><a href="exercise-3-dividend-data.html#cb94-7" tabindex="-1"></a></span>
<span id="cb94-8"><a href="exercise-3-dividend-data.html#cb94-8" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>)</span>
<span id="cb94-9"><a href="exercise-3-dividend-data.html#cb94-9" tabindex="-1"></a></span>
<span id="cb94-10"><a href="exercise-3-dividend-data.html#cb94-10" tabindex="-1"></a><span class="co"># Data split</span></span>
<span id="cb94-11"><a href="exercise-3-dividend-data.html#cb94-11" tabindex="-1"></a>idx <span class="op">=</span> np.random.choice(dividend.index, size<span class="op">=</span><span class="bu">int</span>(<span class="fl">0.8</span> <span class="op">*</span> <span class="bu">len</span>(dividend)), replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb94-12"><a href="exercise-3-dividend-data.html#cb94-12" tabindex="-1"></a>train <span class="op">=</span> dividend.loc[idx]</span>
<span id="cb94-13"><a href="exercise-3-dividend-data.html#cb94-13" tabindex="-1"></a>test <span class="op">=</span> dividend.drop(idx)</span>
<span id="cb94-14"><a href="exercise-3-dividend-data.html#cb94-14" tabindex="-1"></a></span>
<span id="cb94-15"><a href="exercise-3-dividend-data.html#cb94-15" tabindex="-1"></a><span class="co"># Option 1: Standardise the data</span></span>
<span id="cb94-16"><a href="exercise-3-dividend-data.html#cb94-16" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb94-17"><a href="exercise-3-dividend-data.html#cb94-17" tabindex="-1"></a>train_std <span class="op">=</span> train.copy()</span>
<span id="cb94-18"><a href="exercise-3-dividend-data.html#cb94-18" tabindex="-1"></a>train_std.iloc[:, <span class="dv">1</span>:<span class="dv">6</span>] <span class="op">=</span> scaler.fit_transform(train.iloc[:, <span class="dv">1</span>:<span class="dv">6</span>]) <span class="co"># Fit on the training data and transform it</span></span>
<span id="cb94-19"><a href="exercise-3-dividend-data.html#cb94-19" tabindex="-1"></a>test_std <span class="op">=</span> test.copy()</span>
<span id="cb94-20"><a href="exercise-3-dividend-data.html#cb94-20" tabindex="-1"></a>test_std.iloc[:, <span class="dv">1</span>:<span class="dv">6</span>] <span class="op">=</span> scaler.transform(test.iloc[:, <span class="dv">1</span>:<span class="dv">6</span>]) <span class="co"># Use the training data&#39;s parameters to standardise the test data</span></span>
<span id="cb94-21"><a href="exercise-3-dividend-data.html#cb94-21" tabindex="-1"></a></span>
<span id="cb94-22"><a href="exercise-3-dividend-data.html#cb94-22" tabindex="-1"></a><span class="co"># Option 2: Normalise the data</span></span>
<span id="cb94-23"><a href="exercise-3-dividend-data.html#cb94-23" tabindex="-1"></a>scaler_norm <span class="op">=</span> MinMaxScaler()</span>
<span id="cb94-24"><a href="exercise-3-dividend-data.html#cb94-24" tabindex="-1"></a>train_norm <span class="op">=</span> train.copy()</span>
<span id="cb94-25"><a href="exercise-3-dividend-data.html#cb94-25" tabindex="-1"></a>train_norm.iloc[:, <span class="dv">1</span>:<span class="dv">6</span>] <span class="op">=</span> scaler_norm.fit_transform(train.iloc[:, <span class="dv">1</span>:<span class="dv">6</span>])</span>
<span id="cb94-26"><a href="exercise-3-dividend-data.html#cb94-26" tabindex="-1"></a>test_norm <span class="op">=</span> test.copy()</span>
<span id="cb94-27"><a href="exercise-3-dividend-data.html#cb94-27" tabindex="-1"></a>test_norm.iloc[:, <span class="dv">1</span>:<span class="dv">6</span>] <span class="op">=</span> scaler_norm.transform(test.iloc[:, <span class="dv">1</span>:<span class="dv">6</span>])</span></code></pre></div>
</div>
<ol start="7" style="list-style-type: decimal">
<li>Use the Sequential API or subclass <code>nn.Module</code> to build a single-layer perceptron with logistic/sigmoid activation function for the hidden and output layers.</li>
</ol>
<div class="webex-solution">
<button>
Solution
</button>
<p>Use the Sequential API:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="exercise-3-dividend-data.html#cb95-1" tabindex="-1"></a>model <span class="op">=</span> nn.Sequential(</span>
<span id="cb95-2"><a href="exercise-3-dividend-data.html#cb95-2" tabindex="-1"></a>    nn.Linear(<span class="dv">5</span>, <span class="dv">5</span>), <span class="co"># 5 input features -&gt; 5 hidden nodes</span></span>
<span id="cb95-3"><a href="exercise-3-dividend-data.html#cb95-3" tabindex="-1"></a>    nn.Sigmoid(),</span>
<span id="cb95-4"><a href="exercise-3-dividend-data.html#cb95-4" tabindex="-1"></a>    nn.Linear(<span class="dv">5</span>,<span class="dv">1</span>), <span class="co"># 5 hidden nodes -&gt; 1 output (for binary classification)</span></span>
<span id="cb95-5"><a href="exercise-3-dividend-data.html#cb95-5" tabindex="-1"></a>    nn.Sigmoid()</span>
<span id="cb95-6"><a href="exercise-3-dividend-data.html#cb95-6" tabindex="-1"></a>)</span></code></pre></div>
<p>Use the <code>nn.Module</code>:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb96-1"><a href="exercise-3-dividend-data.html#cb96-1" tabindex="-1"></a><span class="kw">class</span> SingleLayer(nn.Module):</span>
<span id="cb96-2"><a href="exercise-3-dividend-data.html#cb96-2" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb96-3"><a href="exercise-3-dividend-data.html#cb96-3" tabindex="-1"></a>        <span class="bu">super</span>(SingleLayer, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb96-4"><a href="exercise-3-dividend-data.html#cb96-4" tabindex="-1"></a>        <span class="va">self</span>.linear <span class="op">=</span> nn.Linear(<span class="dv">5</span>, <span class="dv">5</span>) <span class="co"># 5 input features -&gt; 5 hidden nodes</span></span>
<span id="cb96-5"><a href="exercise-3-dividend-data.html#cb96-5" tabindex="-1"></a>        <span class="va">self</span>.activation <span class="op">=</span> nn.Sigmoid()</span>
<span id="cb96-6"><a href="exercise-3-dividend-data.html#cb96-6" tabindex="-1"></a>        <span class="va">self</span>.classifier <span class="op">=</span> nn.Linear(<span class="dv">5</span>, <span class="dv">1</span>) <span class="co"># 5 hidden nodes -&gt; 1 output (for binary classification)</span></span>
<span id="cb96-7"><a href="exercise-3-dividend-data.html#cb96-7" tabindex="-1"></a></span>
<span id="cb96-8"><a href="exercise-3-dividend-data.html#cb96-8" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, inputs):</span>
<span id="cb96-9"><a href="exercise-3-dividend-data.html#cb96-9" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.linear(inputs) <span class="co"># pass through hidden layer</span></span>
<span id="cb96-10"><a href="exercise-3-dividend-data.html#cb96-10" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.activation(x) <span class="co"># apply sigmoid activation</span></span>
<span id="cb96-11"><a href="exercise-3-dividend-data.html#cb96-11" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.classifier(x) <span class="co"># output layer</span></span>
<span id="cb96-12"><a href="exercise-3-dividend-data.html#cb96-12" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.activation(x)  <span class="co"># apply sigmoid to output</span></span>
<span id="cb96-13"><a href="exercise-3-dividend-data.html#cb96-13" tabindex="-1"></a>        <span class="cf">return</span> x</span>
<span id="cb96-14"><a href="exercise-3-dividend-data.html#cb96-14" tabindex="-1"></a></span>
<span id="cb96-15"><a href="exercise-3-dividend-data.html#cb96-15" tabindex="-1"></a>model <span class="op">=</span> SingleLayer()</span></code></pre></div>
</div>
<p>Next, let's train the model. Since this is a binary classification task, we use the binary cross-entropy loss as our loss function. We will also need to define our training operation -- the optimizer and duration of training -- and use this to train the model. More details on this will be explained in Week 9 lecture note and lab.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb97-1"><a href="exercise-3-dividend-data.html#cb97-1" tabindex="-1"></a><span class="co"># Convert from dataframe to tensor</span></span>
<span id="cb97-2"><a href="exercise-3-dividend-data.html#cb97-2" tabindex="-1"></a>X_tensor <span class="op">=</span> torch.tensor(train_std.iloc[:, <span class="dv">1</span>:<span class="dv">6</span>].values, dtype<span class="op">=</span>torch.float32)</span>
<span id="cb97-3"><a href="exercise-3-dividend-data.html#cb97-3" tabindex="-1"></a>y_tensor <span class="op">=</span> torch.tensor(train_std.iloc[:, <span class="dv">0</span>].values, dtype<span class="op">=</span>torch.float32).view(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb97-4"><a href="exercise-3-dividend-data.html#cb97-4" tabindex="-1"></a></span>
<span id="cb97-5"><a href="exercise-3-dividend-data.html#cb97-5" tabindex="-1"></a>X_test_tensor <span class="op">=</span> torch.tensor(test_std.iloc[:, <span class="dv">1</span>:<span class="dv">6</span>].values, dtype<span class="op">=</span>torch.float32)</span>
<span id="cb97-6"><a href="exercise-3-dividend-data.html#cb97-6" tabindex="-1"></a>y_test_tensor <span class="op">=</span> torch.tensor(test_std.iloc[:, <span class="dv">0</span>].values, dtype<span class="op">=</span>torch.float32).view(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb97-7"><a href="exercise-3-dividend-data.html#cb97-7" tabindex="-1"></a></span>
<span id="cb97-8"><a href="exercise-3-dividend-data.html#cb97-8" tabindex="-1"></a><span class="co"># Specify loss function and optimizer</span></span>
<span id="cb97-9"><a href="exercise-3-dividend-data.html#cb97-9" tabindex="-1"></a>criterion <span class="op">=</span> nn.BCELoss()</span>
<span id="cb97-10"><a href="exercise-3-dividend-data.html#cb97-10" tabindex="-1"></a>optimizer <span class="op">=</span> optim.SGD(model.parameters(), lr<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb97-11"><a href="exercise-3-dividend-data.html#cb97-11" tabindex="-1"></a>num_epochs <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb97-12"><a href="exercise-3-dividend-data.html#cb97-12" tabindex="-1"></a>history <span class="op">=</span> []</span>
<span id="cb97-13"><a href="exercise-3-dividend-data.html#cb97-13" tabindex="-1"></a></span>
<span id="cb97-14"><a href="exercise-3-dividend-data.html#cb97-14" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(num_epochs):</span>
<span id="cb97-15"><a href="exercise-3-dividend-data.html#cb97-15" tabindex="-1"></a></span>
<span id="cb97-16"><a href="exercise-3-dividend-data.html#cb97-16" tabindex="-1"></a>    <span class="co"># Zero the gradients</span></span>
<span id="cb97-17"><a href="exercise-3-dividend-data.html#cb97-17" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb97-18"><a href="exercise-3-dividend-data.html#cb97-18" tabindex="-1"></a></span>
<span id="cb97-19"><a href="exercise-3-dividend-data.html#cb97-19" tabindex="-1"></a>    <span class="co"># Forward pass</span></span>
<span id="cb97-20"><a href="exercise-3-dividend-data.html#cb97-20" tabindex="-1"></a>    y <span class="op">=</span> model(X_tensor)</span>
<span id="cb97-21"><a href="exercise-3-dividend-data.html#cb97-21" tabindex="-1"></a></span>
<span id="cb97-22"><a href="exercise-3-dividend-data.html#cb97-22" tabindex="-1"></a>    <span class="co"># Compute the loss between the predictions and the targets</span></span>
<span id="cb97-23"><a href="exercise-3-dividend-data.html#cb97-23" tabindex="-1"></a>    loss <span class="op">=</span> criterion(y, y_tensor)</span>
<span id="cb97-24"><a href="exercise-3-dividend-data.html#cb97-24" tabindex="-1"></a></span>
<span id="cb97-25"><a href="exercise-3-dividend-data.html#cb97-25" tabindex="-1"></a>    <span class="co"># Backpropagate through the loss to compute gradients</span></span>
<span id="cb97-26"><a href="exercise-3-dividend-data.html#cb97-26" tabindex="-1"></a>    loss.backward()</span>
<span id="cb97-27"><a href="exercise-3-dividend-data.html#cb97-27" tabindex="-1"></a></span>
<span id="cb97-28"><a href="exercise-3-dividend-data.html#cb97-28" tabindex="-1"></a>    <span class="co"># Update x with gradient descent</span></span>
<span id="cb97-29"><a href="exercise-3-dividend-data.html#cb97-29" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb97-30"><a href="exercise-3-dividend-data.html#cb97-30" tabindex="-1"></a></span>
<span id="cb97-31"><a href="exercise-3-dividend-data.html#cb97-31" tabindex="-1"></a>    history.append(loss.item())</span>
<span id="cb97-32"><a href="exercise-3-dividend-data.html#cb97-32" tabindex="-1"></a></span>
<span id="cb97-33"><a href="exercise-3-dividend-data.html#cb97-33" tabindex="-1"></a>plt.plot(history)</span>
<span id="cb97-34"><a href="exercise-3-dividend-data.html#cb97-34" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<p>Finally, we can use our trained neural network for prediction.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb98-1"><a href="exercise-3-dividend-data.html#cb98-1" tabindex="-1"></a>model.<span class="bu">eval</span>()  <span class="co"># Set the model to evaluation mode</span></span></code></pre></div>
<pre><code>## SingleLayer(
##   (linear): Linear(in_features=5, out_features=5, bias=True)
##   (activation): Sigmoid()
##   (classifier): Linear(in_features=5, out_features=1, bias=True)
## )</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb100-1"><a href="exercise-3-dividend-data.html#cb100-1" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():  <span class="co"># Disable gradient computation during prediction</span></span>
<span id="cb100-2"><a href="exercise-3-dividend-data.html#cb100-2" tabindex="-1"></a>    y_pred <span class="op">=</span> model(X_tensor)</span>
<span id="cb100-3"><a href="exercise-3-dividend-data.html#cb100-3" tabindex="-1"></a>    y_test_pred <span class="op">=</span> model(X_test_tensor)</span>
<span id="cb100-4"><a href="exercise-3-dividend-data.html#cb100-4" tabindex="-1"></a>y_pred_binary <span class="op">=</span> (y_pred <span class="op">&gt;=</span> <span class="fl">0.5</span>).<span class="bu">float</span>()  <span class="co"># Threshold at 0.5 to get binary predictions</span></span>
<span id="cb100-5"><a href="exercise-3-dividend-data.html#cb100-5" tabindex="-1"></a>y_test_pred_binary <span class="op">=</span> (y_test_pred <span class="op">&gt;=</span> <span class="fl">0.5</span>).<span class="bu">float</span>()  <span class="co"># Threshold at 0.5 to get binary predictions</span></span>
<span id="cb100-6"><a href="exercise-3-dividend-data.html#cb100-6" tabindex="-1"></a></span>
<span id="cb100-7"><a href="exercise-3-dividend-data.html#cb100-7" tabindex="-1"></a><span class="co"># Calculate accuracy</span></span>
<span id="cb100-8"><a href="exercise-3-dividend-data.html#cb100-8" tabindex="-1"></a>correct_predictions <span class="op">=</span> (y_pred_binary <span class="op">==</span> y_tensor)</span>
<span id="cb100-9"><a href="exercise-3-dividend-data.html#cb100-9" tabindex="-1"></a>train_accuracy <span class="op">=</span> correct_predictions.<span class="bu">sum</span>().item() <span class="op">/</span> y_tensor.shape[<span class="dv">0</span>]  <span class="co"># Training accuracy</span></span>
<span id="cb100-10"><a href="exercise-3-dividend-data.html#cb100-10" tabindex="-1"></a>correct_predictions <span class="op">=</span> (y_test_pred_binary <span class="op">==</span> y_test_tensor)</span>
<span id="cb100-11"><a href="exercise-3-dividend-data.html#cb100-11" tabindex="-1"></a>test_accuracy <span class="op">=</span> correct_predictions.<span class="bu">sum</span>().item() <span class="op">/</span> y_test_tensor.shape[<span class="dv">0</span>]  <span class="co"># Training accuracy</span></span>
<span id="cb100-12"><a href="exercise-3-dividend-data.html#cb100-12" tabindex="-1"></a></span>
<span id="cb100-13"><a href="exercise-3-dividend-data.html#cb100-13" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Training accuracy: </span><span class="sc">{</span>train_accuracy <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%, Test accuracy: </span><span class="sc">{</span>test_accuracy <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%&#39;</span>)</span></code></pre></div>
<pre><code>## Training accuracy: 96.25%, Test accuracy: 92.50%</code></pre>

</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script>
            </section>

          </div>
        </div>
      </div>
<a href="introduction-to-pytorch.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["main.pdf", "main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
