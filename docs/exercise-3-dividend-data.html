<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Exercise 3: Dividend data | STATS5099 Data Mining and Machine Learning</title>
  <meta name="description" content="4 Exercise 3: Dividend data | STATS5099 Data Mining and Machine Learning" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Exercise 3: Dividend data | STATS5099 Data Mining and Machine Learning" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Exercise 3: Dividend data | STATS5099 Data Mining and Machine Learning" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exercise-2-german-data.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="include/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome to DMML Lab 8</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#implementing-neural-networks-in-r"><i class="fa fa-check"></i><b>1.1</b> Implementing neural networks in <code>R</code></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exercise-1-task-2-in-lecture-notes.html"><a href="exercise-1-task-2-in-lecture-notes.html"><i class="fa fa-check"></i><b>2</b> Exercise 1: Task 2 in lecture notes</a></li>
<li class="chapter" data-level="3" data-path="exercise-2-german-data.html"><a href="exercise-2-german-data.html"><i class="fa fa-check"></i><b>3</b> Exercise 2: German data</a></li>
<li class="chapter" data-level="4" data-path="exercise-3-dividend-data.html"><a href="exercise-3-dividend-data.html"><i class="fa fa-check"></i><b>4</b> Exercise 3: Dividend data</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STATS5099 Data Mining and Machine Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exercise-3-dividend-data" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Exercise 3: Dividend data<a href="exercise-3-dividend-data.html#exercise-3-dividend-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this example, our goal is to develop a neural network to determine if a stock pays a dividend or not. The dataset is stored under <code>dividendinfo.csv</code>, which includes one response variable and five predictor variables.</p>
<ul>
<li><code>dividend</code> (class): A value of 1 indicates that the stock pays a dividend; 0 indicates that the stock that does not pay a dividend.</li>
<li><code>fcfps</code>: Free cash flow per share (in $)</li>
<li><code>earnings_growth</code>: Earnings growth in the past year (in %)</li>
<li><code>de</code>: Debt to Equity ratio</li>
<li><code>mcap</code>: Market Capitalization of the stock</li>
<li><code>current_ratio</code>: Current Ratio (or Current Assets/Current Liabilities)</li>
</ul>
<p><strong>Task</strong></p>
<ol style="list-style-type: decimal">
<li>Read in the data and perform exploratory analysis. What have you observed?</li>
</ol>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="exercise-3-dividend-data.html#cb21-1" tabindex="-1"></a>dividend <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;dividendinfo.csv&quot;</span>)</span>
<span id="cb21-2"><a href="exercise-3-dividend-data.html#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="exercise-3-dividend-data.html#cb21-3" tabindex="-1"></a><span class="co"># some example codes for numerical summaries</span></span>
<span id="cb21-4"><a href="exercise-3-dividend-data.html#cb21-4" tabindex="-1"></a><span class="fu">summary</span>(dividend)</span>
<span id="cb21-5"><a href="exercise-3-dividend-data.html#cb21-5" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb21-6"><a href="exercise-3-dividend-data.html#cb21-6" tabindex="-1"></a><span class="fu">skim</span>(dividend)</span>
<span id="cb21-7"><a href="exercise-3-dividend-data.html#cb21-7" tabindex="-1"></a></span>
<span id="cb21-8"><a href="exercise-3-dividend-data.html#cb21-8" tabindex="-1"></a><span class="co"># some example codes for graphical summaries</span></span>
<span id="cb21-9"><a href="exercise-3-dividend-data.html#cb21-9" tabindex="-1"></a><span class="fu">pairs</span>(dividend)</span>
<span id="cb21-10"><a href="exercise-3-dividend-data.html#cb21-10" tabindex="-1"></a><span class="fu">libray</span>(GGally)</span>
<span id="cb21-11"><a href="exercise-3-dividend-data.html#cb21-11" tabindex="-1"></a><span class="fu">ggpairs</span>(dividend)</span>
<span id="cb21-12"><a href="exercise-3-dividend-data.html#cb21-12" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>));</span>
<span id="cb21-13"><a href="exercise-3-dividend-data.html#cb21-13" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(dividend),<span class="cf">function</span>(i) <span class="fu">boxplot</span>(dividend[,i]<span class="sc">~</span>dividend<span class="sc">$</span>dividend)))</span></code></pre></div>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Pre-process and split the data to prepare for training and evaluating a neural network.</li>
</ol>
<div class="webex-solution">
<button>
Hint
</button>
<p>As all variables are continuous and they have quite different ranges, scale them either using standardisation or min-max normalisation.</p>
</div>
<div class="webex-solution">
<button>
Solution
</button>
<p>While there are built-in functions such as <code>scale</code> to standardise the entire data, the best practice is to split the data into training and test first and then apply standardisation/normalisation. This could avoid information leakage from training to test data.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="exercise-3-dividend-data.html#cb22-1" tabindex="-1"></a><span class="co"># Data split</span></span>
<span id="cb22-2"><a href="exercise-3-dividend-data.html#cb22-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb22-3"><a href="exercise-3-dividend-data.html#cb22-3" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(dividend),<span class="fl">0.8</span><span class="sc">*</span><span class="fu">nrow</span>(dividend))</span>
<span id="cb22-4"><a href="exercise-3-dividend-data.html#cb22-4" tabindex="-1"></a>train <span class="ot">&lt;-</span> dividend[idx,]</span>
<span id="cb22-5"><a href="exercise-3-dividend-data.html#cb22-5" tabindex="-1"></a>test <span class="ot">&lt;-</span> dividend[<span class="sc">-</span>idx,]</span>
<span id="cb22-6"><a href="exercise-3-dividend-data.html#cb22-6" tabindex="-1"></a></span>
<span id="cb22-7"><a href="exercise-3-dividend-data.html#cb22-7" tabindex="-1"></a><span class="co"># option 1: Standardise the data</span></span>
<span id="cb22-8"><a href="exercise-3-dividend-data.html#cb22-8" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">apply</span>(train[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>], <span class="dv">2</span>, mean)</span>
<span id="cb22-9"><a href="exercise-3-dividend-data.html#cb22-9" tabindex="-1"></a>sds <span class="ot">&lt;-</span> <span class="fu">apply</span>(train[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>], <span class="dv">2</span>, sd)</span>
<span id="cb22-10"><a href="exercise-3-dividend-data.html#cb22-10" tabindex="-1"></a>train.std <span class="ot">&lt;-</span> <span class="fu">scale</span>(train[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb22-11"><a href="exercise-3-dividend-data.html#cb22-11" tabindex="-1"></a>train.std <span class="ot">&lt;-</span> <span class="fu">cbind</span>(train[,<span class="dv">1</span>],train.std)</span>
<span id="cb22-12"><a href="exercise-3-dividend-data.html#cb22-12" tabindex="-1"></a>test.std  <span class="ot">&lt;-</span> <span class="fu">scale</span>(test[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>], means, sds)</span>
<span id="cb22-13"><a href="exercise-3-dividend-data.html#cb22-13" tabindex="-1"></a>test.std  <span class="ot">&lt;-</span> <span class="fu">cbind</span>(test[,<span class="dv">1</span>],test.std)</span>
<span id="cb22-14"><a href="exercise-3-dividend-data.html#cb22-14" tabindex="-1"></a></span>
<span id="cb22-15"><a href="exercise-3-dividend-data.html#cb22-15" tabindex="-1"></a><span class="co"># option 2: Normalise the data</span></span>
<span id="cb22-16"><a href="exercise-3-dividend-data.html#cb22-16" tabindex="-1"></a>min_max_scale_test <span class="ot">&lt;-</span> <span class="cf">function</span>(x_tr, x_te){</span>
<span id="cb22-17"><a href="exercise-3-dividend-data.html#cb22-17" tabindex="-1"></a>  mins <span class="ot">&lt;-</span> <span class="fu">apply</span>(x_tr, <span class="dv">2</span>, min)</span>
<span id="cb22-18"><a href="exercise-3-dividend-data.html#cb22-18" tabindex="-1"></a>  maxs <span class="ot">&lt;-</span> <span class="fu">apply</span>(x_tr, <span class="dv">2</span>, max)</span>
<span id="cb22-19"><a href="exercise-3-dividend-data.html#cb22-19" tabindex="-1"></a>  x_te <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mins,maxs, x_te)</span>
<span id="cb22-20"><a href="exercise-3-dividend-data.html#cb22-20" tabindex="-1"></a>  x_te <span class="ot">&lt;-</span> <span class="fu">apply</span>(x_te, <span class="dv">2</span>, <span class="cf">function</span>(x) (x<span class="sc">-</span>x[<span class="dv">1</span>])<span class="sc">/</span>(x[<span class="dv">2</span>]<span class="sc">-</span>x[<span class="dv">1</span>]))</span>
<span id="cb22-21"><a href="exercise-3-dividend-data.html#cb22-21" tabindex="-1"></a>  x_te <span class="ot">&lt;-</span> x_te[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),]</span>
<span id="cb22-22"><a href="exercise-3-dividend-data.html#cb22-22" tabindex="-1"></a>}</span>
<span id="cb22-23"><a href="exercise-3-dividend-data.html#cb22-23" tabindex="-1"></a></span>
<span id="cb22-24"><a href="exercise-3-dividend-data.html#cb22-24" tabindex="-1"></a>train.norm <span class="ot">&lt;-</span><span class="fu">apply</span>(train[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>], <span class="dv">2</span>, <span class="cf">function</span>(x) (x<span class="sc">-</span><span class="fu">min</span>(x))<span class="sc">/</span>(<span class="fu">max</span>(x)<span class="sc">-</span><span class="fu">min</span>(x)) )</span>
<span id="cb22-25"><a href="exercise-3-dividend-data.html#cb22-25" tabindex="-1"></a>train.norm <span class="ot">&lt;-</span><span class="fu">cbind</span>(train[,<span class="dv">1</span>],train.norm)</span>
<span id="cb22-26"><a href="exercise-3-dividend-data.html#cb22-26" tabindex="-1"></a>test.norm  <span class="ot">&lt;-</span><span class="fu">min_max_scale_test</span>(train[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>], test[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb22-27"><a href="exercise-3-dividend-data.html#cb22-27" tabindex="-1"></a>test.norm  <span class="ot">&lt;-</span><span class="fu">cbind</span>(test[,<span class="dv">1</span>], test.norm)</span></code></pre></div>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Build a neural network with a single hidden layer, any number of hidden nodes, and the logistic function as the activation function. Interpret the relative importance of variables using the <code>garson</code> function.</li>
</ol>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="exercise-3-dividend-data.html#cb23-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb23-2"><a href="exercise-3-dividend-data.html#cb23-2" tabindex="-1"></a>nn_di <span class="ot">&lt;-</span> <span class="fu">neuralnet</span>(dividend<span class="sc">~</span>., <span class="at">data=</span>train, <span class="at">hidden=</span><span class="fu">c</span>(<span class="dv">5</span>), <span class="at">err.fct=</span><span class="st">&quot;ce&quot;</span>, <span class="at">act.fct=</span><span class="st">&quot;logistic&quot;</span>, <span class="at">linear.output=</span><span class="cn">FALSE</span>, <span class="at">likelihood=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-3"><a href="exercise-3-dividend-data.html#cb23-3" tabindex="-1"></a></span>
<span id="cb23-4"><a href="exercise-3-dividend-data.html#cb23-4" tabindex="-1"></a><span class="fu">garson</span>(nn_di)</span></code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>We can see that the variable <code>current_ratio</code> is the one with the strongest relationship with the response variable <code>dividend</code>, followed by <code>de</code>, <code>fcfps</code> and <code>mcap</code>. The variable <code>earnings_growth</code> has the least relationship with <code>dividend</code>.</p>
</div>
<ol start="4" style="list-style-type: decimal">
<li>Fit the above model multiple times using the argument <code>rep</code> and select the optimal model.</li>
</ol>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="exercise-3-dividend-data.html#cb24-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb24-2"><a href="exercise-3-dividend-data.html#cb24-2" tabindex="-1"></a>nn_di <span class="ot">&lt;-</span> <span class="fu">neuralnet</span>(dividend<span class="sc">~</span>., <span class="at">data=</span>train, <span class="at">hidden=</span><span class="fu">c</span>(<span class="dv">5</span>), <span class="at">err.fct=</span><span class="st">&quot;ce&quot;</span>, <span class="at">act.fct=</span><span class="st">&quot;logistic&quot;</span>, <span class="at">linear.output=</span><span class="cn">FALSE</span>, <span class="at">likelihood=</span><span class="cn">TRUE</span>, <span class="at">rep=</span><span class="dv">5</span>)</span>
<span id="cb24-3"><a href="exercise-3-dividend-data.html#cb24-3" tabindex="-1"></a></span>
<span id="cb24-4"><a href="exercise-3-dividend-data.html#cb24-4" tabindex="-1"></a><span class="co"># plot(nn_di)</span></span>
<span id="cb24-5"><a href="exercise-3-dividend-data.html#cb24-5" tabindex="-1"></a><span class="fu">plot</span>(nn_di, <span class="at">rep=</span><span class="st">&quot;best&quot;</span>)</span></code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>From the plots (<code>plot(nn_di)</code>), we can see that the optimisation algorithm stops at different iterations (from <code>Steps</code>) and lead to differnt cross-entropy loss (from <code>Error</code>). In general, training the network longer decreases the cross-entropy loss. However, this decrease takes place on the training data set and may not generalise to the test. In other words, training the model longer may increase the risk of overfitting.</p>
<p>To select the optimal model, we could look at the AIC and BIC values.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="exercise-3-dividend-data.html#cb25-1" tabindex="-1"></a><span class="fu">which.min</span>(nn_di<span class="sc">$</span>result.matrix[<span class="dv">4</span>,]) <span class="co">#AIC</span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="exercise-3-dividend-data.html#cb27-1" tabindex="-1"></a><span class="fu">which.min</span>(nn_di<span class="sc">$</span>result.matrix[<span class="dv">5</span>,]) <span class="co">#AIC</span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>AIC and BIC agree in this case and they both choose the third repetition.</p>
</div>

</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script>
            </section>

          </div>
        </div>
      </div>
<a href="exercise-2-german-data.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["main.pdf", "main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
